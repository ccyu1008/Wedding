<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>æˆ‘å€‘çš„è–èª•å©šç¦®é‚€è«‹</title>
    <style>
        /* ä¿®æ­£ 2: æ·±è–èª•ç´…èƒŒæ™¯ */
        body {
            margin: 0;
            overflow: hidden;
            /* æ·±é‚ƒè–èª•ç´…èˆ‡é»‘çš„æ¼¸è®ŠèƒŒæ™¯ */
            background: linear-gradient(135deg, #3A0202 0%, #1A0000 70%); /* èƒŒæ™¯èª¿å¾—æ›´æ·± */
            font-family: "Microsoft JhengHei", sans-serif;
            touch-action: none;
        }
        canvas { display: block; }
        
        /* è¼‰å…¥ç•«é¢ */
        #loading-overlay {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background: #1A0000;
            color: #FFD700;
            display: flex; justify-content: center; align-items: center;
            font-size: 1.6em; font-weight: bold;
            z-index: 100; transition: opacity 1s;
        }

        /* å€’æ•¸è¨ˆæ™‚å™¨ */
        #countdown {
            position: absolute; top: 15px; width: 100%;
            text-align: center;
            color: #FFD700; font-weight: bold; font-size: 1.2em;
            z-index: 10; padding: 8px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px; text-shadow: 0 0 10px #FFD700;
        }

        /* å©šå®´è³‡è¨ŠæŒ‰éˆ• (å–ä»£é»æ“Šå¡ç‰‡) */
        #info-btn {
            position: fixed; bottom: 20px; left: 50%;
            transform: translateX(-50%);
            /* è–èª•é‡‘ */
            background: #FFD700;
            color: #8B0000;
            padding: 14px 40px; border-radius: 50px;
            font-weight: bold; cursor: pointer; z-index: 90;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.7), 0 0 15px #FFD700; /* é‡‘è‰²ç™¼å…‰ */
            transition: 0.3s;
            font-size: 1.1em;
        }
        #info-btn:hover { background: #FFEA00; transform: translateX(-50%) scale(1.05); }

        /* å½ˆå‡ºè³‡è¨Šè¦–çª— */
        #info-modal {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.88);
            display: none; justify-content: center; align-items: center;
            z-index: 80; backdrop-filter: blur(6px);
            opacity: 0; transition: opacity 0.3s; 
        }
        #info-modal.show { opacity: 1; } 
        
        #info-content {
            background: linear-gradient(135deg, #FFF8E7, #F5F5DC);
            padding: 35px; border-radius: 15px;
            max-width: 88%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            color: #333;
            border: 3px solid #FFD700; position: relative;
        }
        .close-btn {
            position: absolute; top: 8px; right: 15px;
            font-size: 2.8em; font-weight: bold; cursor: pointer;
            color: #880000;
        }
        #info-content h3 {
            color: #880000; text-align: center;
            border-bottom: 3px solid #FFD700;
            padding-bottom: 8px; margin: 0 0 20px 0;
            font-size: 1.6em;
        }
        #info-content p {
            margin: 10px 0;
            font-size: 1.1em;
        }
        #info-content a {
            color: #880000;
            text-decoration: underline;
            font-weight: bold;
        }
    </style>
</head>
<body>
<div id="loading-overlay">è–èª•å–œå¸–è¼‰å…¥ä¸­...</div>
<div id="countdown"></div>
<div id="info-btn">é»æˆ‘æŸ¥çœ‹å©šå®´è³‡è¨Š</div>

<div id="info-modal">
    <div id="info-content">
        <span class="close-btn">Ã—</span>
        <h3>å©šå®´è³‡è¨Šè©³æƒ…</h3>
        <p><strong>åœ°é»ï½œ</strong>æ™¶å®´ãƒ»æ—¥å…‰é¦™é Œ</p>
        <p><strong>åœ°å€ï½œ</strong>å°åŒ—å¸‚ä¸­å±±å€æ°‘ç”Ÿæ±è·¯ä¸‰æ®µ 8 è™Ÿ 1 æ¨“</p>
        <p><a href="https://maps.app.goo.gl/6mG21w1w3n3kE9499" target="_blank">ğŸ“Œ Google åœ°åœ–ï¼ˆæœƒå ´ï¼‰</a></p>
        <hr style="margin:20px 0">
        <p><strong>åœè»Šï½œ</strong>24TPS æ°¸å›ºä¾¿åˆ©åœè»Šå ´</p>
        <p><strong>åœ°å€ï½œ</strong>10491 è‡ºåŒ—å¸‚ä¸­å±±å€æ°‘ç”Ÿæ±è·¯ä¸‰æ®µ 8 è™Ÿ B2</p>
        <p><a href="https://maps.app.goo.gl/x7J9qFbLaP9hGD8NA" target="_blank">ğŸ…¿ï¸ Google åœ°åœ–ï¼ˆåœè»Šå ´ï¼‰</a></p>
    </div>
</div>

<script type="importmap">
{
    "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
    }
}
</script>
<script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    const scene = new THREE.Scene();
    // æ·±è–èª•ç´…éœ§æ•ˆ
    scene.fog = new THREE.FogExp2(0x3A0202, 0.018); 
    const camera = new THREE.PerspectiveCamera(45, innerWidth/innerHeight, 0.1, 1000);
    camera.position.set(0,0,10);

    const renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
    renderer.setSize(innerWidth, innerHeight);
    renderer.setPixelRatio(devicePixelRatio);
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    // ç¨å¾®æé«˜ä¸€é»æ›å…‰ï¼Œè®“èƒŒé¢çš„åå…‰èƒ½é¡¯ç¾
    renderer.toneMappingExposure = 1.5; 
    document.body.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true; controls.minDistance = 4; controls.maxDistance = 15; controls.enablePan = false;

    // ç’°å¢ƒå…‰
    scene.add(new THREE.AmbientLight(0xffffff, 1.2)); 

    const loading = document.getElementById('loading-overlay');
    const weddingDate = new Date("December 25, 2025 12:00:00").getTime();

    // ==================== æª”æ¡ˆè·¯å¾‘ (æœ€çµ‚ç¢ºèªç‰ˆæœ¬) ====================
    const FILE_PATHS = {
        FRONT_HDR: './textures/photo_front_hdr.jpg',
        BACK_BASE: './photo_back.png',
        BACK_HDR: './textures/photo_back_hdr.jpg',
        ENV_MAP: './textures/hdr.jpg'
    };

    const loader = new THREE.TextureLoader();
    let loaded = 0, total = 4;
    let frontHdrTex, backBaseTex, backHdrTex, envMap;

    const dummyTexture = new THREE.Texture();
    dummyTexture.colorSpace = THREE.SRGBColorSpace;


    function allLoaded() {
        if (++loaded === total) {
            createCard();
            animateIntro();
            loading.style.opacity = 0;
            setTimeout(()=>loading.style.display='none',1000);
            animate(); 
        }
    }

    const loadTexture = (path, name, successCallback, isEnvMap = false) => {
        loader.load(path, (texture) => {
            if (isEnvMap) {
                const pmrem = new THREE.PMREMGenerator(renderer);
                pmrem.compileEquirectangularShader();
                envMap = pmrem.fromEquirectangular(texture).texture;
                scene.environment = envMap;
                texture.dispose(); pmrem.dispose();
            } else if (successCallback) {
                successCallback(texture);
            }
            allLoaded();
        }, undefined, (err) => {
            console.error(`Error loading ${name} from ${path}. Using dummy texture.`, err);
            if (!isEnvMap && successCallback) {
                 successCallback(dummyTexture);
            } else if (isEnvMap) {
                scene.add(new THREE.AmbientLight(0xffffff, 1.5)); 
            }
            allLoaded();
        });
    };

    loadTexture(FILE_PATHS.FRONT_HDR, 'Front HDR', (t) => { frontHdrTex = t; });
    loadTexture(FILE_PATHS.BACK_BASE, 'Back Base', (t) => { backBaseTex = t; t.colorSpace = THREE.SRGBColorSpace; });
    loadTexture(FILE_PATHS.BACK_HDR , 'Back HDR', (t) => { backHdrTex = t; });
    loadTexture(FILE_PATHS.ENV_MAP, 'Env Map', null, true); 

    // ==================== å¡ç‰‡æœ¬é«” (æè³ªä¿®æ­£) ====================
    let cardMesh;
    function createCard() {
        const geo = new THREE.BoxGeometry(4.36, 2.97, 0.015);
        
        // ç´™å¼µé¡è‰²
        const DEEP_RED = 0x550000; 
        
        // ä¿®æ­£ 1: å°‡ç±³ç™½åº•è‰²èª¿äº®
        const LIGHT_BASE = 0xFFFDE7; // è±¡ç‰™ç™½
        const STAMP_COLOR_FRONT = 0xCC9933; // æ·±é‡‘è‰² (ç‡™é‡‘)

        // 1. å´é¢æè³ª (æ·±è‰²ã€éœ§é¢ç´™å¼µ)
        const sideMat = new THREE.MeshPhysicalMaterial({ 
            color: DEEP_RED, 
            metalness: 0.0, 
            roughness: 1.0, 
            envMapIntensity: 0.1 
        });

        // 2. æ­£é¢æè³ª (æ·±ç´…è‰²ç´™å¼µ + è³ªæ„Ÿç‡™é‡‘å‡¹é™·)
        const frontMat = new THREE.MeshPhysicalMaterial({
            color: DEEP_RED,
            metalness: 0.0,
            roughness: 1.0, // éœ§é¢ç´™å¼µ
            
            // ç‡™é‡‘ (Emissive æ¨¡æ“¬)
            emissive: STAMP_COLOR_FRONT,
            emissiveMap: frontHdrTex,
            emissiveIntensity: 0.8, 

            // å£“å‡¹æ•ˆæœ
            bumpMap: frontHdrTex,
            bumpScale: -0.015, 
            
            envMapIntensity: 0.1, 
        });

        // 3. èƒŒé¢æè³ª (éœ§é¢åº•åœ– + å±€éƒ¨éŠ€è‰²åå…‰)
        const backMat = new THREE.MeshPhysicalMaterial({
            map: backBaseTex,
            // ä¿®æ­£ 1: èª¿æ•´åŸºåº•è‰²åˆ°è¼ƒäº®çš„ç±³ç™½
            color: LIGHT_BASE,
            
            // ä¿®æ­£ 2: ç¢ºä¿å…¨åœ–ä¸åå°„
            metalness: 0.0,
            roughness: 1.0, // åŸºç¤ç‚ºå…¨éœ§é¢
            
            // Clearcoat (æ¸…æ¼†å±¤) ä¾†æ¨¡æ“¬å±€éƒ¨çš„éŠ€è‰²ç‡™å°åå…‰
            clearcoatMap: backHdrTex,
            clearcoat: 1.0,
            clearcoatRoughness: 0.15, // èª¿æ•´åˆ°æ›´å…‰æ»‘ä¸€é»é»

            // ä¿®æ­£ 2: åƒ…è®“æ¸…æ¼†å±¤åå°„ç’°å¢ƒå…‰ (Clearcoatçš„åå…‰å¼·åº¦èˆ‡ envMapIntensity ç›¸é—œ)
            // å°‡ envMapIntensity ä¿æŒä½å€¼ï¼Œä½† Clearcoat æœ¬èº«æœƒåˆ©ç”¨é€™å€‹å€¼
            envMapIntensity: 1.5,
        });

        // çµ„åˆå¡ç‰‡
        cardMesh = new THREE.Mesh(geo, [
            sideMat, sideMat, sideMat, sideMat, 
            frontMat, // æ­£é¢
            backMat   // èƒŒé¢
        ]);

        cardMesh.scale.set(0.01,0.01,0.01);
        scene.add(cardMesh);
        window.cardMesh = cardMesh; 
    }

    // ==================== å…¶é¤˜åŠŸèƒ½ (ä¸è®Š) ====================
    
    // é›ªèŠ±
    const snowGeo = new THREE.BufferGeometry();
    const vertices = [];
    for(let i=0;i<800;i++){
        vertices.push(THREE.MathUtils.randFloatSpread(40), THREE.MathUtils.randFloat(0,30), THREE.MathUtils.randFloatSpread(40));
    }
    snowGeo.setAttribute('position', new THREE.Float32BufferAttribute(vertices,3));
    const snow = new THREE.Points(snowGeo, new THREE.PointsMaterial({color:0xffffff,size:0.14,transparent:true,opacity:0.9}));
    scene.add(snow);

    function animateSnow(){
        const pos = snow.geometry.attributes.position.array;
        for(let i=1;i<pos.length;i+=3){
            pos[i] -= 0.015;
            if(pos[i] < -15) pos[i] = 30;
        }
        snow.geometry.attributes.position.needsUpdate = true;
        requestAnimationFrame(animateSnow);
    }
    animateSnow();

    // é€²å ´å‹•ç•«
    function animateIntro(){
        if (!cardMesh) return;
        const start = Date.now();
        const loop = ()=>{
            const t = Math.min(1,(Date.now()-start)/1800);
            const s = 0.01 + t*0.99;
            cardMesh.scale.set(s,s,s);
            cardMesh.rotation.y = t * Math.PI * 4;
            if(t<1) requestAnimationFrame(loop);
            else{ cardMesh.scale.set(1,1,1); controls.enabled=true; }
        };
        controls.enabled = false;
        loop();
    }

    // ä¸»è¿´åœˆ
    function animate(){
        requestAnimationFrame(animate);
        if(cardMesh && controls.enabled) cardMesh.rotation.y += 0.0008;
        controls.update();
        renderer.render(scene,camera);
    }

    // å€’æ•¸è¨ˆæ™‚
    const cd = document.getElementById('countdown');
    setInterval(()=>{
        const diff = weddingDate - Date.now();
        if(diff<0){ cd.innerHTML="ä»Šå¤©å°±æ˜¯æˆ‘å€‘çš„è–èª•å©šç¦®ï¼"; return; }
        const d=Math.floor(diff/(1e3*60*60*24));
        const h=Math.floor((diff%(1e3*60*60*24))/(1e3*60*60));
        const m=Math.floor((diff%(1e3*60*60))/(1e3*60));
        const s=Math.floor((diff%(1e3*60))/1e3);
        cd.innerHTML=`è–èª•å©šç¦®å€’æ•¸ï¼š${d}å¤© ${h}å°æ™‚ ${m}åˆ† ${s}ç§’ â¤ï¸`;
    },1000);

    // å½ˆçª—æ§åˆ¶é‚è¼¯
    const infoModal = document.getElementById('info-modal');
    document.getElementById('info-btn').onclick = ()=> {
        infoModal.style.display='flex';
        setTimeout(()=>infoModal.classList.add('show'), 10); 
    };
    const closeInfo = ()=> {
        infoModal.classList.remove('show');
        setTimeout(()=>infoModal.style.display='none', 300); 
    };
    document.querySelector('.close-btn').onclick = closeInfo;
    infoModal.onclick = e=> {if(e.target===e.currentTarget) closeInfo();};

    window.addEventListener('resize',()=>{
        camera.aspect = innerWidth/innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(innerWidth,innerHeight);
    });
</script>
</body>
</html>